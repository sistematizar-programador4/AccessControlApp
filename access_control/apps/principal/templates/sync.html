{% extends 'layout/base.html' %}

{% load staticfiles %}

{% block content_head %}
	<link rel="stylesheet" href="{% static 'css/lobibox.css' %}">
	<link rel="stylesheet" href="{% static 'css/jquery-ui.min.css' %}">
	<script src="{% static 'js/detail.js' %}"></script>
	<script src="{% static 'js/lobibox.js' %}"></script>
	<script src="{% static 'js/jquery-ui.min.js' %}"></script>
	<script>
		$(document).ready(function (){
			$('#sync_access').click(function(){
				var asis = 'false';
				Lobibox.alert('info', {
					title: "Alerta",
					msg: "¿Desea enviar correos a los acudientes de alumnos que asistieron?",
					buttons:{
						yes: {
							'text': 'Si'
						},
						no: {
							'text': 'No'
						}
					},
					callback: function(lobibox, type){
						if(type == 'yes'){
							asis = 'true';
						}
						sync_access(asis);
					}
				});
				return false;
			});
			function sync_alum(href, con){
				$.ajax({
					url: href,
					data: {'confirm': con},
					type: 'POST',
					beforeSend: function(){
						$('.loading').empty();
						$('.loading').append(load_event);
					},
					success: function(value){
						$('.loading').empty();
						if(value.state == 'state'){
							$('.loading').append(
								'<p><strong>Total alumnos sincronizados: </strong>'+value.totalum+'</p>'+
								'<p><strong>Total alumnos nuevos: </strong>'+value.newalum+'</p>'+
								'<p><strong>Total alumnos actualizados: </strong>'+value.upalum+'</p>'
							);
						}
						Lobibox.notify(value.type, {
							title: value.title,
							msg: value.message,
							sound: false,
						});
					}
				});
			}
			$('.sync').click(function() {
				var href = $(this).attr('href');
				var con = 'false';
				Lobibox.alert('info', {
					title: "Alerta",
					msg: "¿Desea actualizar los alumnos?",
					buttons:{
						yes: {
							'text': 'Actualizar alumnos'
						},
						no: {
							'text': 'No, solo sincronizar'
						}
					},
					callback: function(lobibox, type){
						if(type == 'yes'){
							con = 'true';
						}
						sync_alum(href, con);
					}
				});
				return false;
			});
		});
	</script>
{% endblock content_head %}

{% block content %}
	<section class="sectionForm" style="text-align: center;">
		<section class="headerForm">
			<legend class="titleForm">
				Sincronización
			</legend>
		</section>
		<h2>Seleccione una opción</h2>
		<img src="{% static 'img/separator.png' %}" style="width: 40%; height: auto; padding-top: 20px;">
		<div class="form_new">
			<a href="{% url 'sync_alum' %}" class="btn btn-accept sync">Sincronizar Alumnos</a>
			<a href="#" class="btn btn-accept" id="sync_access">Sincronizar Ingreso/Salida</a>
		</div>
	</section>
{% endblock content %}